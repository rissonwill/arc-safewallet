// scripts/generate-bytecodes.mjs
// Gera arquivo de bytecodes para uso no frontend

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));
const artifactsDir = path.join(__dirname, '../artifacts/contracts');
const outputFile = path.join(__dirname, '../client/src/lib/contractBytecodes.ts');

const contracts = ['ArcToken', 'ArcNFT', 'ArcMarketplace', 'ArcVault'];

async function main() {
  console.log('üì¶ Gerando arquivo de bytecodes...\n');

  const bytecodes = {};

  for (const contractName of contracts) {
    const artifactPath = path.join(artifactsDir, `${contractName}.sol`, `${contractName}.json`);
    
    if (!fs.existsSync(artifactPath)) {
      console.log(`‚ö†Ô∏è Artefato n√£o encontrado: ${contractName}`);
      continue;
    }

    const artifact = JSON.parse(fs.readFileSync(artifactPath, 'utf8'));
    
    bytecodes[contractName] = {
      abi: artifact.abi,
      bytecode: artifact.bytecode,
    };

    console.log(`‚úÖ ${contractName}: ${artifact.bytecode.length} bytes`);
  }

  // Gerar arquivo TypeScript
  const output = `// Auto-generated file - DO NOT EDIT
// Generated by scripts/generate-bytecodes.mjs

export const CONTRACT_ARTIFACTS = ${JSON.stringify(bytecodes, null, 2)} as const;

export type ContractName = keyof typeof CONTRACT_ARTIFACTS;

export function getContractArtifact(name: ContractName) {
  return CONTRACT_ARTIFACTS[name];
}
`;

  fs.writeFileSync(outputFile, output);
  console.log(`\n‚úÖ Arquivo gerado: ${outputFile}`);
}

main().catch(console.error);
